---
interface Props {
    href: string;
    img: string;
    title: string;
}

const { href, img, title } = Astro.props;

async function fetchRepoDescription(repoUrl) {
    try {
        const api = `${repoUrl.replace('github.com', 'api.github.com/repos')}`;
        const response = await fetch(api);

        if (!response.ok) {
            throw new Error(`Failed to fetch repository description. Status: ${response.status}`);
        }

        const data = await response.json();
        return data.description || 'No description available';
    } catch (error) {
        console.error('Error fetching repository description:', error);
        return 'Failed to fetch repository description';
    }
}

const desc = await fetchRepoDescription(href);
---

<section id="card">
    <a href={href} data-astro-prefetch><img src={img} id="card__img" alt={title}/></a>
    <h3>{title}</h3>
    <p>{desc}</p>
</section>

<style lang="scss">
    #card {
        max-width: 350px;
        padding: 1% 2%;
        margin: 1% 1%;
        border-radius: 15px;
        background-color: var(--suede);
        color: white;
        &__img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
        }
    }
</style>